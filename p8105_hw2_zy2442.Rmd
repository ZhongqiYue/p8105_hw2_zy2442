---
title: "Homework 2"
author: Zhongqi Yue
output: github_document
---

```{r setup}
library(tidyverse)
library(readxl)
```

## Problem 1

Read the Mr. Trashwheel dataset.

```{r}
trashwheel_df = 
  read_xlsx(
    "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "Mr. Trash Wheel",
    range = cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate(
    sports_balls = round(sports_balls),
    sports_balls = as.integer(sports_balls)
  )
```

Read precipitation data for 2018 and 2017.

```{r}
precip_2018 =
  read_excel(
    "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2018 Precipitation",
    skip = 1
    ) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018) %>% 
  relocate(year)

precip_2017 =
  read_excel(
    "./data/Trash-Wheel-Collection-Totals-8-6-19.xlsx",
    sheet = "2017 Precipitation",
    skip = 1
    ) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2017) %>% 
  relocate(year)
```

Now combine annual precipitation.

```{r}
month_df = 
  tibble(
    month = 1:12,
    month_name = month.name
  )

precip_df = 
  bind_rows(precip_2018,precip_2017) 

left_join(precip_df, month_df, by = "month" )
```

This dataset contains information from the Mr. Trashwheel trash collector in Baltimore, Maryland. As trash enters the inner harbor, the trashwheel collects that trash, and stores it in a dumpster. The dataset contains information on year, month, and trash collected, include some specific kinds of trash. There are a total of `r nrow(trashwheel_df)` rows in our final dataset. Additional data sheets include month precipitation data.
The median number of sports balls found in a dumpster in 2017 was `r trashwheel_df %>% filter(year == 2017) %>% pull(sports_balls) %>% median()`
The total precipitation in 2018 was `r precip_df %>% filter(year == 2018) %>% pull(total) %>% sum()` inches.

# Problem 2

Read and clean the NYC Transit dataset.

```{r}
NYC_transit_df = read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv")
NYC_transit_df = janitor::clean_names(NYC_transit_df)
```

Choose some columns and not others.

```{r}
select(NYC_transit_df, line, station_name, station_latitude, station_longitude, route1, route2, route3, route4, route5, route6, route7, route8, route9, route10, route11, entry, vending, entrance_type, ada)
```

Now convert the entry variable from character to a logical variable.

```{r}
NYC_transit_df = 
  read_csv("./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>% 
  janitor::clean_names() %>% 
  select(line, station_name, station_latitude, station_longitude, route1, route2, route3, route4, route5, route6, route7, route8, route9, route10, route11, entry, vending, entrance_type, ada) %>% 
  mutate(entry = recode(entry, "YES"="TRUE", "NO"="FALSE"), entry = as.logical(entry))
```

The original data set contains 32 variables, which include character, double and logical variables. First, I clean the name of each variable to make them all in lower case. Then I only retain the line, station, name, station latitude / longitude, routes served, entry, vending, entrance type, and ADA compliance, which are the variables the question interested in. After this step, there are only 19 variables left. Next, I convert the "entry" from character variable to logical variable by using "recode" function. The resulting data set has `r nrow(NYC_transit_df)` rows and `r ncol(NYC_transit_df)` columns. These data are tidy now such that columns are variable names all in lower case and single columns contain single variables.

```{r}
nrow(distinct(NYC_transit_df, line, station_name, .keep_all = TRUE))
count(filter(NYC_transit_df,ada == "TRUE"))
count(filter(NYC_transit_df, vending == "NO"))/sum(count(filter(NYC_transit_df, entry == "TRUE"))+count(filter(NYC_transit_df, entry == "FALSE")))
```

* There are 465 distinct stations.
* 468 stations are ADA compliant.
* The proportion of station entrances / exits without vending allow entrance is 0.0980 or 9.80%.

# Problem 3

Read and clean the pols-month dataset.

```{r}
pols_month_df = 
  read_csv("./fivethirtyeight_datasets/pols-month.csv") %>% 
  janitor::clean_names() %>% 
  separate(mon, c("year","month", "day")) %>% 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) %>% 
  mutate(month = month.name[month]) %>% 
  mutate(president = prez_gop + prez_dem) %>% 
  select(-prez_gop, -prez_dem) %>% 
  select(-day)
```

Read and clean the snp.csv dataset.

```{r}
snp_df = 
  read_csv("./fivethirtyeight_datasets/snp.csv")%>% 
  janitor::clean_names() %>% 
  separate(date, c("month","day", "year")) %>% 
  mutate(
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  ) %>% 
  mutate(month = month.name[month]) %>% 
  relocate(year, month)
```